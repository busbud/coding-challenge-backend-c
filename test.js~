var http = require('http');
var url = require('url');
var port = process.env.PORT || 2345;
var fs = require('fs');
var es = require('event-stream');
var extend = require('util')._extend;


setTimeout(function() {a = readCityFile('data/cities_canada-usa.tsv'); console.log(a);}, 1000);



function readCityFile(file) {
  var cities = {};
  fs.createReadStream('data/cities_canada-usa.tsv')
    .pipe(es.split('\n'))
    .pipe(es.mapSync(function(data) { 
      return data.split("\t"); }))
    .pipe(es.mapSync(function(data) {
      cities[data[0]]={}; 
      cities[data[0]]['name'] = data[1]; 
      cities[data[0]]['ascii'] = data[2]; 
      cities[data[0]]['latitude'] = data[4]; 
      cities[data[0]]['longitude'] = data[5]; }))
    .pipe(es.wait(function(){
      delete cities[''];
      delete cities['id'];
    }));
  return cities;
}


