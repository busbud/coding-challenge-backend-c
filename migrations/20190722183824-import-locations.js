"use strict";
const { runUp, COLLECTION } = require("./../src/suggestions/import");

/**
 * Code auto-generated by migration third-party library.
 */
let dbm;
let type;
let seed;

/**
 * Code auto-generated by migration librairy.
 */
exports.setup = function(options, seedLink) {
  dbm = options.dbmigrate;
  type = dbm.dataType;
  seed = seedLink;
};

/**
 * Import the locations into mongo db. Returns a promise so the migration doesn't hang.
 *
 * @returns {Promise}
 */
exports.up = async db => {
  const mongo = await db.connection.connect(db.connectionString);
  await runUp(mongo);
  await mongo.collection('locations').createIndex( { "testGeo" : "2dsphere" } )
  mongo.close()  
};

/**
 * Delete all locations from mongo.
 *
 * @returns { Promise }
 */
exports.down = async function(db) {
  return db.connection.connect(db.connectionString).then(mongo => {
    mongo
      .collection(COLLECTION)
      .remove()
      .then(res => {
        mongo.close();
      })
      .catch(err => {
        mongo.close();
      });
  });
};

exports._meta = {
  version: 1
};
